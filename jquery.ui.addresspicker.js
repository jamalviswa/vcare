(function(a,b){a.widget("ui.addresspicker",{options:{appendAddressString:"",draggableMarker:true,regionBias:null,bounds:"",componentsFilter:"",updateCallback:null,reverseGeocode:false,autocomplete:"default",language:"",mapOptions:{zoom:5,center:new google.maps.LatLng(46,2),scrollwheel:false,mapTypeId:google.maps.MapTypeId.ROADMAP},elements:{map:false,lat:false,lng:false,street_number:false,route:false,locality:false,sublocality:false,administrative_area_level_3:false,administrative_area_level_2:false,administrative_area_level_1:false,country:false,postal_code:false,type:false},autocomplete:""},marker:function(){return this.gmarker},map:function(){return this.gmap},updatePosition:function(){this._updatePosition(this.gmarker.getPosition())},reloadPosition:function(){this.gmarker.setVisible(true);this.gmarker.setPosition(new google.maps.LatLng(this.lat.val,this.lng.val));this.gmap.setCenter(this.gmarker.getPosition())},resize:function(){google.maps.event.trigger(this.gmap,"resize")},selected:function(){return this.selectedResult},_mapped:{},_create:function(){var c=this;this.geocoder={geocode:function(d,e){jQuery.ajax({url:"https://maps.googleapis.com/maps/api/geocode/json?"+jQuery.param(d)+"&sensor=false",type:"GET",success:function(f){e(f.results,f.status)}})}};if(this.options.autocomplete==="bootstrap"){this.element.typeahead({source:function(f,h){c._mapped={};var d=function(k){var l=[];for(var j=0;j<k.length;j++){c._mapped[k[j].label]=k[j];l.push(k[j].label)}h(l)};var e={term:f};c._geocode(e,d)},updater:function(d){var e={item:c._mapped[d]};c._focusAddress(null,e);c._selectAddress(null,e);return d}})}else{this.element.autocomplete(a.extend({source:a.proxy(this._geocode,this),focus:a.proxy(this._focusAddress,this),select:a.proxy(this._selectAddress,this)}),this.options.autocomplete)}this.lat=a(this.options.elements.lat);this.lng=a(this.options.elements.lng);this.street_number=a(this.options.elements.street_number);this.route=a(this.options.elements.route);this.locality=a(this.options.elements.locality);this.sublocality=a(this.options.elements.sublocality);this.administrative_area_level_3=a(this.options.elements.administrative_area_level_3);this.administrative_area_level_2=a(this.options.elements.administrative_area_level_2);this.administrative_area_level_1=a(this.options.elements.administrative_area_level_1);this.country=a(this.options.elements.country);this.postal_code=a(this.options.elements.postal_code);this.type=a(this.options.elements.type);if(this.options.elements.map){this.mapElement=a(this.options.elements.map);this._initMap()}},_initMap:function(){if(this.lat&&this.lat.val()){this.options.mapOptions.center=new google.maps.LatLng(this.lat.val(),this.lng.val())}this.gmap=new google.maps.Map(this.mapElement[0],this.options.mapOptions);this.gmarker=new google.maps.Marker({position:this.options.mapOptions.center,map:this.gmap,draggable:this.options.draggableMarker});google.maps.event.addListener(this.gmarker,"dragend",a.proxy(this._markerMoved,this));this.gmarker.setVisible(false)},_updatePosition:function(c){if(this.lat){this.lat.val(c.lat())}if(this.lng){this.lng.val(c.lng())}},_addressParts:{street_number:null,route:null,locality:null,sublocality:null,administrative_area_level_3:null,administrative_area_level_2:null,administrative_area_level_1:null,country:null,postal_code:null,type:null},_updateAddressParts:function(c){parsedResult=this._parseGeocodeResult(c);for(addressPart in this._addressParts){if(this[addressPart]){if(parsedResult[addressPart]!==false){this[addressPart].val(parsedResult[addressPart])}else{this[addressPart].val("")}}}},_updateAddressPartsViaReverseGeocode:function(c){this.geocoder.geocode({latlng:c.lat()+","+c.lng()},a.proxy(function(e,d){if(d==google.maps.GeocoderStatus.OK){this._updateAddressParts(e[0]);this.element.val(e[0].formatted_address);this.selectedResult=e[0];if(this.options.updateCallback){this.options.updateCallback(this.selectedResult,this._parseGeocodeResult(this.selectedResult))}}},this))},_parseGeocodeResult:function(e){var d=this._parseLatAndLng(e.geometry.location);for(var c in this._addressParts){d[c]=this._findInfo(e,c)}d.type=e.types[0];return d},_parseLatAndLng:function(c){var d,e;if(typeof(c.lat)==="function"){e=c.lat();d=c.lng()}else{e=c.lat;d=c.lng}return{lat:e,lng:d}},_markerMoved:function(){this._updatePosition(this.gmarker.getPosition());if(this.options.reverseGeocode){this._updateAddressPartsViaReverseGeocode(this.gmarker.getPosition())}},_geocode:function(f,e){var c=f.term,d=this;this.geocoder.geocode({language:this.options.language,address:c+this.options.appendAddressString,region:this.options.regionBias,bounds:this.options.bounds,components:this.options.componentsFilter},function(k,h){if(h==google.maps.GeocoderStatus.OK&&k){for(var j=0;j<k.length;j++){result=k[j];g=result.geometry;g.location=new google.maps.LatLng(g.location.lat,g.location.lng);g.viewport=new google.maps.LatLngBounds(new google.maps.LatLng(g.viewport.southwest.lat,g.viewport.southwest.lng),new google.maps.LatLng(g.viewport.northeast.lat,g.viewport.northeast.lng));result.label=k[j].formatted_address}}e(k)})},_findInfo:function(c,f){for(var e=0;e<c.address_components.length;e++){var d=c.address_components[e];if(d.types.indexOf(f)!=-1){return d.long_name}}return false},_focusAddress:function(d,e){var c=e.item;if(!c){return}if(this.gmarker){this.gmarker.setPosition(c.geometry.location);this.gmarker.setVisible(true);this.gmap.fitBounds(c.geometry.viewport)}this._updatePosition(c.geometry.location);this._updateAddressParts(c)},_selectAddress:function(c,d){this.selectedResult=d.item;if(this.options.updateCallback){this.options.updateCallback(this.selectedResult,this._parseGeocodeResult(this.selectedResult))}}});a.extend(a.ui.addresspicker,{version:"@VERSION"});if(!Array.indexOf){Array.prototype.indexOf=function(d){for(var c=0;c<this.length;c++){if(this[c]==d){return c}}return -1}}})(jQuery);